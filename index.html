<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="alternate"
      type="appliation/rss+xml"
      href="http://bastibe.de/rss.xml"
      title="RSS feed for http://bastibe.de/">
<title>Bastibe.de</title><meta  name="author" content="Bastian Bechtold" />
<link href='http://fonts.googleapis.com/css?family=Roboto&subset=latin' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
<link href= "static/style.css" rel="stylesheet" type="text/css" />
<link rel="icon" href="static/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="static/favicon-152.png">
<link rel="msapplication-TitleImage" href="static/favicon-144.png">
<link rel="msapplication-TitleColor" href="#0141ff">
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"> </script>
<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1"></head>
<body>
<div id="preamble" class="status"><div class="header">
  <a href="http://bastibe.de">Basti's Scratchpad on the Internet</a>
  <div class="sitelinks">
    <a href="http://alpha.app.net/bastibe">alpha.app.net</a> | <a href="http://github.com/bastibe">Github</a>
  </div>
</div></div>
<div id="content"><div class="post-date">24 Nov 2016</div><h1 class="post-title"><a href="http://bastibe.de/2016-11-24-pip-is-great.html">Pip is great</a></h1>
<p>
<a href="http://bastibe.de/2011-02-03-installing-python-slash-numpy-slash-scipy-slash-matplotlib-on-osx.html">Installing</a> <a href="http://bastibe.de/2011-03-04-installing-pygame-using-homebrew.html">Python</a> <a href="http://bastibe.de/2011-08-01-compiling-scipy-and-matplotlib-using-pip-on-lion.html">packages</a> <a href="http://bastibe.de/2011-10-13-compiling-scipy-and-matplotlib-again.html">used</a> to be a pain. Very surprisingly, this is no longer the case. Nowadays, <code>pip install whatever</code> will reliably install pretty much anything without any trouble.
</p>

<p>
To recap, the problem is that many Python packages rely on C code, which needs to be compiled before installation. In the past, this burden was mostly on the user. Depending on the user's knowledge of C and compilers, and the user's operating system, this could become almost arbitrarily hairy.
</p>

<p>
This problem was solved, to some extent, using pre-compiled packages, first as <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">binary installers</a> on the package websites, then pre-packaged <a href="http://winpython.github.io/">Python</a> <a href="https://www.continuum.io/anaconda-overview">distributions</a>, and later through third-party package managers such as <a href="http://conda.pydata.org/docs/">conda</a>.
</p>

<p>
This worked well, but it fractured the ecosystem into several different mostly-compatible package sources. This was no big problem, but users had to decide on a package-by-package basis whether to download an installer, use conda, or use pip.
</p>

<p>
But I am happy to announce that these dark days are behind us now. Pip now automatically installs binary Python packages called <a href="http://wheel.readthedocs.io/en/latest/">wheels</a>, and most package developers <a href="http://pythonwheels.com/">do now provide</a> wheels on <a href="https://pypi.python.org/pypi">PyPI</a>. This is so obviously superior to the past that many high-profile packages don't even provide binary installers any more.
</p>

<p>
For me, this means I don't have to rely on conda any longer. I don't have to keep a mental list of which packages to install though conda and which packages to install through pip any longer. I can go back to using virtualenv instead of conda-envs<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup> again. I don't have to tell students to download pre-packaged Python distributions any longer. Pip is great!
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
Not because I dislike conda, just to simplify my development environment.
</p></div>


</div>
</div><div class="post-date">22 Nov 2016</div><h1 class="post-title"><a href="http://bastibe.de/2016-11-22-soma.html">Soma</a></h1>
<p>
For a long time, I was afraid of picking up Soma, since it came from the developers who did Amnesia. Amnesia was the first game that scared me so thoroughly that I just couldn't bring myself to pick it up again after the first session. I admired it for its amazing world design, interactivity, and story, but it was too scary for me. I don't enjoy being scared.
</p>

<p>
I was thus of two minds when I heard about Soma: Soma was supposed to be less scary, and SciFi. But still, let me get this out of the way; This game scared me whitless. I had to use an online game guide to warn me of monsters and tell me how to evade them. I was too scared to figure this stuff out by myself, all alone in this creepy, nasty, underwater space station.
</p>

<p>
But at the same time, this game delivered one of the best stories I have ever seen in a video game. The story left me shaken and thoughtful for days, and the story was what dragged me back into the game even though I was really struggling with the monster sections. Even the delivery through conversations, environmental clues, and audio logs, was truly outstanding. I just love grimy Alien-style SciFi, and this is one of the very few video game stories that could fill more than a paragraph or two in a well-written book. I love it.
</p>

<p>
Apparently, if you like horror games, this is a very mild one. Boring even, if you can believe my favorite <a href="https://www.youtube.com/watch?v=Y6BPcSYibco">online</a> <a href="https://www.youtube.com/watch?v=J4tbbcWqDyY">critics</a>. But believe me, it was right on the edge of what I was able to take. I still can't quite decide whether I would have preferred this game without the monsters, or whether the monsters were a necessary tool for evoking this intense sense of dread on the lonely SciFi ocean floor. Maybe the monsters lent some much-needed life and interactivity to the walk-em-up formula.
</p>

<p>
At any rate, I thoroughly enjoyed this experience, and can't wait for what this developer will create next. I wholeheartedly recommend this, as one of the best SciFi stories of this year, in any medium. ★★★★★
</p>
<div class="post-date">07 Sep 2016</div><h1 class="post-title"><a href="http://bastibe.de/2016-09-07-matlab-syntax.html">MATLAB Syntax</a></h1>
<p>
In a <a href="https://github.com/bastibe/MatlabCodeAnalyzer">recent project</a>, I tried to parse MATLAB code. During this trying exercise, I stumbled upon a few&#x2026; <i>unique</i> design decisions of the MATLAB language:
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Use of apostrophes (<code>'</code>)</h2>
<div class="outline-text-2" id="text-1">
<p>
Apostrophes can mean one of two things: If applied as a unary postfix operator, it means <i>transpose</i>. If used as a unary prefix operator, it marks the start of a string. While not a big problem for human readers, this makes code surprisingly hard to parse. The interesting bit about this, though, is the fact that there would have been a much easier way to do this: Why not use double quotation marks for strings, and apostrophes for transpose? The double quotation mark is <i>never</i> used in MATLAB, so this would have been a very easy choice.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Use of parens (<code>()</code>)</h2>
<div class="outline-text-2" id="text-2">
<p>
If Parens follow a variable name, they can mean one of two things: If the variable is a function, the parens denote a <i>function call</i>. If the variable is anything else, this is an indexing operation. This can actually be very confusing to readers, since it makes it entirely unclear what kind of operation <code>foo(5)</code> will execute without knowledge about <code>foo</code> (which might not be available until runtime). Again, this could have been easily solved by using brackets (<code>[]</code>) for indexing, and parens (<code>()</code>) for function calls.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Use of braces (<code>{}</code>) and cell arrays</h2>
<div class="outline-text-2" id="text-3">
<p>
Cell arrays are multi-dimensional, ordered, heterogeneous collections of things. But in contrast to every other collection (structs, objects, maps, tables, matrices), they are not indexed using parens, but <i>braces</i>. Why? I don't know. In fact, you <i>can</i> index cell arrays using parens, but this only yields a new cell array with only one value. Why would this ever be useful? I have no explanation. This constantly leads to errors, and for the life of me I can not think of a reason for this behavior.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Use of line breaks</h2>
<div class="outline-text-2" id="text-4">
<p>
In MATLAB, your line can end on one of three characters: A newline character, a semicolon (<code>;</code>), and a comma (,). As we all know, the semicolon suppresses program output, while the newline character does not. The comma ends the logical line, but does not suppress program output. This is a relatively little-known feature, so I thought it would be useful to share it. Except, the meaning of <code>;</code> and , changes in literals (like <code>[1, 2; 3, 4]</code> or <code>{'a', 'b'; 3, 4}</code>). Here, commas separate values on the same row and are optional, and semicolons end the current row. Interestingly, literals also change the meaning of the newline character: Inside a literal, a newline acts just like a semicolon, overrides a preceding comma, and you don't have to use ellipsis (<code>...</code>) for line continuations.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Syntax rules for commands</h2>
<div class="outline-text-2" id="text-5">
<p>
Commands are function calls without the parenthesis, like <code>help disp</code>, which is syntactically equivalent to <code>help('disp')</code>. You see, if you just specify a function name (can't be a compound expression or a function handle), and don't use parenthesis, all following words will be interpreted as strings, and passed to the function. This is actually kind of a neat feature. However, how do you differentiate between <code>variable_name + 5</code> and <code>help + 5</code>? The answer is: Commands are actually a bit more complex. A command starts with a function name, followed by a space, which is not followed by an operator <i>and a space</i>. Thus, <code>help +5 + 4</code> is a command, while <code>help + 5 + 4</code> is an addition. Tricky!
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">The more-than-one-value value</h2>
<div class="outline-text-2" id="text-6">
<p>
If you want to save more than one value in a variable, you can use a collection (structs, matrices, maps, tables, cell arrays). In addition though, MATLAB knows another way of handling more than one values at once: The thing you get when you index a cell array with <code>{:}</code> or assign a function call with more than one result. In that case, you get something that is assignable to several variables, but that is not itself a collection. Just another quirk of MATLAB's indexing logic. However, you can capture these values into matrices or cell arrays using brackets or braces, like this: <code>{x{:}}</code> or <code>[x{:}]</code>. Note that this also works in assignments in a confusing way: <code>[z{:}] = x{:}</code> (if both x and z have the same length). Incidentally, this is often a neat way of converting between different kinds of collections (but utterly unreadable, because type information is hopelessly lost).
</p>
</div>
</div>
<div class="post-date">26 Jun 2016</div><h1 class="post-title"><a href="http://bastibe.de/2016-06-26-pollen.html">P⋅O⋅L⋅L⋅E⋅N and Walk 'em ups</a></h1>
<p>
I like boring games. I like games that give me time to think. Like <a href="http://x-plane.org/">flight</a> <a href="http://www.prepar3d.com/">simulators</a>, <a href="http://eurotrucksimulator2.com/">truck</a> <a href="http://www.americantrucksimulator.com/">simulators</a>, <a href="https://en.wikipedia.org/wiki/Civilization_V">history simulators</a>, and (don't call them walking simulators) <a href="https://en.wikipedia.org/wiki/The_Stanley_Parable">walk</a> '<a href="http://gonehome.game/">em</a> <a href="http://www.firewatchgame.com/">ups</a>. And this weekend, this year's Steam Summer Sale started, and thus it was time to get some gaming done!
</p>

<p>
First, I played <a href="https://en.wikipedia.org/wiki/Everybody's_Gone_to_the_Rapture">Everybody's Gone to the Rapture</a>, a walk 'em up that got good reviews, and was especially praised for it's story. And it dutifully enraptured me, with its British landscapes, and personal story lines. But somehow it didn't quite connect. Maybe I'm not <a href="http://www.gamesradar.com/how-enjoy-everybodys-gone-rapture-real-englishman-explains/">British</a> enough, and I certainly didn't get all of the story. Still, this is well worth picking up, and visiting a digital Shropshire after just having visited the real one earlier this year was a real treat!
</p>

<p>
Second, I played P⋅O⋅L⋅L⋅E⋅N. It did not start well: The download took ages, I had to unplug all that fancy flight simulation gear to get it to recognize my controller, and performance was rather lackluster. Oh, and reviews were rather mediocre, too. (Also, here's a free tip for you if you games developers: putting fancy Unicode characters into your game title does not improve SEO).
</p>

<p>
But, I entirely fell in love with P⋅O⋅L⋅L⋅E⋅N! You arrive on <a href="https://en.wikipedia.org/wiki/Titan_(moon)">Titan</a> in your dinky near-future space capsule, take a short walk on the surface of the moon, and then explore the local space station. Of course, something went wrong, and the space station is deserted. Oh, and there is something about space bees.
</p>

<p>
What really worked for me here was the environmental story telling. This is a space station much in the tradition of <a href="https://typesetinthefuture.com/2014/01/31/2001-a-space-odyssey/">2001: A Space Odyssey</a> and <a href="https://typesetinthefuture.com/2014/12/01/alien/">Alien</a>. It's that perfect utilitarian and inhumanely sterile work place that human corporation always strive for, and human employees always mess up. The stark industrial bleakness of these <a href="http://scificorridorarchive.com/">space corridors</a> is the perfect backdrop to make those little human irregularities really stand out.
</p>

<p>
There is no conflict, only light puzzles, and the story is developed only through voice diaries and environmental clutter. But in contrast to Rapture, it all makes sense. The futurist setting, the deep humanity of the people dealing with it. The creepiness of machines without operators. The struggle of the scientists and engineers against the forces of nature and greedy corporations. The nods —nay— genuflections to everything that has ever been great in Scifi. Even that Kubrick ending. I loved every inch of this! ★★★★★
</p>
<div class="post-date">21 Jun 2016</div><h1 class="post-title"><a href="http://bastibe.de/2016-06-21-transplant-revisited.html">Transplant, revisited</a></h1>
<p>
A few months ago, I <a href="http://bastibe.de/2015-11-03-matlab-engine-performance.html">talked about</a> the performance of calling Matlab from Python. Since then, I implemented a few optimizations that make working with Transplant a lot faster:
</p>


<div class="figure">
<p><img src="http://bastibe.de/static/2016-06/timings.png" alt="timings.png" />
</p>
</div>

<p>
The workload consisted of generating a bunch of random numbers (not included in the times), and sending them to Matlab for computation. This task is entirely dominated by the time it takes to transfer the data to Matlab (see table at the end for intra-language benchmarks of the same task).
</p>

<p>
As you can see, the new Transplant is significantly faster <del>for small workloads, and still a factor of two faster for larger amounts of data</del>. It is now almost always a faster solution than the Matlab Engine for Python (MEfP) and Oct2Py. <del>For very large datasets, Oct2Py might be preferable, though.</del>
</p>

<p>
This improvement comes from three major changes: Matlab functions are now returned as callable objects instead of ad-hoc functions, Transplant now uses MsgPack instead of JSON, and <code>loadlibrary</code> instead of a Mex file to call into <code>libzmq</code>. All of these changes are entirely under the hood, though, and the public API remains unchanged.
</p>

<p>
The callable object thing is the big one for small workloads. The advantage is that the objects will only fetch documentation if <code>__doc__</code> is actually asked for. As it turns out, running <code>help('funcname')</code> for every function call is kind of a big overhead.
</p>

<p>
Bigger workloads however are dominated by the time it takes Matlab to decode the data. String parsing is very slow in Matlab, which is a bad thing indeed if you're planning to read a couple hundred megabytes of JSON. Thus, I replaced JSON with MsgPack, which eliminates the parsing overhead almost entirely. JSON messaging is still available, though, if you pass <code>msgformat='json'</code> to the constructor. <b>Edit:</b> Additionally, binary data is no longer encoded as base64 strings, but passed directly through MsgPack. This yields about a ten-fold performance improvement, especially for larger data sets.
</p>

<p>
Lastly, I rewrote the ZeroMQ interaction to use <code>loadlibrary</code> instead of a Mex file. This has no impact on processing speed at all, but you don't have to <a href="http://bastibe.de/2016-05-31-Matlab-FFI.html">worry about</a> compiling that C code any more.
</p>

<p>
Oh, and Transplant now works on Windows!
</p>

<p>
Here is the above data again in tabular form:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Task</th>
<th scope="col" class="left">New Transplant</th>
<th scope="col" class="left">Old Transplant</th>
<th scope="col" class="left">Oct2Py</th>
<th scope="col" class="left">MEfP</th>
<th scope="col" class="left">Matlab</th>
<th scope="col" class="left">Numpy</th>
<th scope="col" class="left">Octave</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">startup</td>
<td class="left">4.8 s</td>
<td class="left">5.8 s</td>
<td class="left">11 ms</td>
<td class="left">4.6 s</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">sum(randn(1,1))</td>
<td class="left">3.36 ms</td>
<td class="left">34.2 ms</td>
<td class="left">29.6 ms</td>
<td class="left">1.8 ms</td>
<td class="left">9.6 μs</td>
<td class="left">1.8 μs</td>
<td class="left">6 μs</td>
</tr>

<tr>
<td class="left">sum(randn(1,10))</td>
<td class="left">3.71 ms</td>
<td class="left">35.8 ms</td>
<td class="left">30.5 ms</td>
<td class="left">1.8 ms</td>
<td class="left">1.8 μs</td>
<td class="left">1.8 μs</td>
<td class="left">9 μs</td>
</tr>

<tr>
<td class="left">sum(randn(1,100))</td>
<td class="left">3.27 ms</td>
<td class="left">33.9 ms</td>
<td class="left">29.5 ms</td>
<td class="left">2.06 ms</td>
<td class="left">2.2 μs</td>
<td class="left">1.8 μs</td>
<td class="left">9 μs</td>
</tr>

<tr>
<td class="left">sum(randn(1,1000))</td>
<td class="left">4.26 ms</td>
<td class="left">32.7 ms</td>
<td class="left">30.6 ms</td>
<td class="left">9.1 ms</td>
<td class="left">4.1 μs</td>
<td class="left">2.3 μs</td>
<td class="left">12 μs</td>
</tr>

<tr>
<td class="left">sum(randn(1,1e4))</td>
<td class="left">4.35 ms</td>
<td class="left">34.5 ms</td>
<td class="left">30 ms</td>
<td class="left">72.2 ms</td>
<td class="left">25 μs</td>
<td class="left">5.8 μs</td>
<td class="left">38 μs</td>
</tr>

<tr>
<td class="left">sum(randn(1,1e5))</td>
<td class="left">5.45 ms</td>
<td class="left">86.1 ms</td>
<td class="left">31.2 ms</td>
<td class="left">712 ms</td>
<td class="left">55 μs</td>
<td class="left">38.6 μs</td>
<td class="left">280 μs</td>
</tr>

<tr>
<td class="left">sum(randn(1,1e6))</td>
<td class="left">44.1 ms</td>
<td class="left">874 ms</td>
<td class="left">45.7 ms</td>
<td class="left">7.21 s</td>
<td class="left">430 μs</td>
<td class="left">355 μs</td>
<td class="left">2.2 ms</td>
</tr>

<tr>
<td class="left">sum(randn(1,1e7))</td>
<td class="left">285 ms</td>
<td class="left">10.6 s</td>
<td class="left">643 ms</td>
<td class="left">72 s</td>
<td class="left">3.5 ms</td>
<td class="left">5.04 ms</td>
<td class="left">22 ms</td>
</tr>
</tbody>
</table>
<div id="archive">
  <a href="archive.html">Older posts</a>
</div>
</div>
</body>
