<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Sound in Python</title>
<!-- 2013-11-12 Tue 16:39 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Bastian Bechtold" />
<link rel="alternate" type="appliation/rss+xml"
                href="http://bastibe.de/rss.xml"
                title="RSS feed for bastibe.de">
          <link href='http://fonts.googleapis.com/css?family=Roboto&subset=latin' rel='stylesheet' type='text/css'>
          <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
          <link href= "static/style.css" rel="stylesheet" type="text/css" />
          <title>Basti's Scratchpad on the Internet</title>
          <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
          <meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1">
</head>
<body>
<div id="preamble" class="status">
<div class="header">
              <a href="http://bastibe.de">Basti's Scratchpad on the Internet</a>
              <div class="sitelinks">
                  <a href="http://alpha.app.net/bastibe">alpha.app.net</a>  | <a href="http://github.com/bastibe">Github</a>
              </div>
          </div>
</div>
<div id="content">
<h1 class="title">Sound in Python</h1>
<p>
I have to work with sound data a lot. I need to read sound data from a file or a sound card, then I do some calculations on the data, then I need to write sound data back to a file or play it on a sound card. These days, my weapon of choice is Python, and the Numpy/Scipy/Matplotlib-stack of libraries.
</p>

<p>
But while Python and Scipy make for an awesome environment for processing numerical data, it has always been difficult to read and write sound data. Thus, I present to you PySoundFile and PySoundCard, two libraries that set out to create a simple but powerful environment to work with sound data in Python and Scipy.
</p>

<p>
On this blog, I have already experimented with <a href="http://bastibe.de/posts/Real-Time-Signal-Processing-in-Python.html">calling C code from Python using Cython</a>. Since then, I have discovered the <a href="http://cffi.readthedocs.org/">CFFI</a>, which provides a much nicer way to do the same thing. Also, I did some work to port <a href="http://people.csail.mit.edu/hubert/pyaudio/">PyAudio</a> to Python 3 and worked on a few projects using <a href="http://www.portaudio.com/">portaudio</a> and <a href="http://www.mega-nerd.com/libsndfile/">libsndfile</a>. All of this convinced me that it was time to get my hands dirty and code my own sound library for Python.
</p>

<p>
One disclaimer though: All the code presented here is still super-duper alpha quality. APIs may still change and there will be bugs. Windows installation requires manual copying of files.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Reading and Writing Sound Files</h2>
<div class="outline-text-2" id="text-1">
<p>
So how do you read sound files in Python? The Python standard library provides <a href="http://docs.python.org/2/library/wave.html">wave</a>, scipy provides <a href="http://docs.scipy.org/doc/scipy/reference/tutorial/io.html#module-scipy.io.wavfile">scipy.io.wavfile</a>, and there is a SciKit called <a href="http://scikits.appspot.com/audiolab">scikits.audiolab</a>. What I want is a library that can read and write sound data as NumPy arrays. <code>wave</code> and <code>scipy.io.wavfile</code> only use <code>bytes</code>, which I have to convert to NumPy arrays before I can do calculations on them.
</p>

<p>
Most C libraries read and write data the C way: The first time you read a few frames, you get the the first few frames, the second time, you get the second few, then the third few and so on. Similarly, writing puts data at the current position and advances the write pointer by the number of bytes written. This is the way <code>scikits.audiolab</code> works. I find that I often just want to read the first second of audio data, or the last second of audio data, or indeed the whole file at once. This is somewhat difficult to do the C way, but trivial if you could use NumPy slicing syntax.
</p>

<p>
Thus, enter PySoundFile, which supports both these modes of operation:
</p>

<p>
Read a sound file chunk-by-chunk:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #718c00;">from</span> pysoundfile <span style="color: #718c00;">import</span> SoundFile
<span style="color: #eab700;">f</span> = SoundFile(<span style="color: #3e999f;">'filename'</span>)
<span style="color: #718c00;">for</span> n <span style="color: #718c00;">in</span> <span style="color: #8959a8;">range</span>(<span style="color: #8959a8;">len</span>(f)//1024+1):
    <span style="color: #eab700;">chunk</span> = f.read(1024)
</pre>
</div>

<p>
Or read the first/last 100 frames:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #718c00;">from</span> pysoundfile <span style="color: #718c00;">import</span> SoundFile
<span style="color: #eab700;">f</span> = SoundFile(<span style="color: #3e999f;">'filename'</span>)
<span style="color: #eab700;">first</span> = f[:100]
<span style="color: #eab700;">last</span> = f[-100:]
</pre>
</div>

<p>
Or read the whole file:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #718c00;">from</span> pysoundfile <span style="color: #718c00;">import</span> SoundFile
<span style="color: #eab700;">chunk</span> = SoundFile(<span style="color: #3e999f;">'filename'</span>)[:]
</pre>
</div>

<p>
Also note that there is no explicit opening or closing of the SoundFile object. The file pointer is opened when the object is created and closed when the object goes out of scope. I find this much nicer to work with than explicit opening and closing.
</p>

<p>
See also: <a href="http://stackoverflow.com/questions/2060628/how-to-read-wav-file-in-python">StackOverflow</a>
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Recording and Playing Sound Data</h2>
<div class="outline-text-2" id="text-2">
<p>
[ <a href="http://people.csail.mit.edu/hubert/pyaudio/">http://people.csail.mit.edu/hubert/pyaudio/</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="archive"><a href="archive.html">Other posts</a></div>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
              /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
              var disqus_shortname = 'bastibe';
              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              </script>
              <noscript>Please enable JavaScript to view the
                  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</body>
</html>
